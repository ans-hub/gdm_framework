# Builds opengl example

ROOTDIR = ../../
APPNAME = triangle

LIBDIR = $(ROOTDIR)libs/
WINLIB = $(LIBDIR)window/
SYSLIB = $(LIBDIR)system/
SRCFILES = $(wildcard *.cc)

CXX = g++
CXXFLAGS  = -I $(ROOTDIR) -L $(LIBDIR) -L $(WINLIB) -L $(SYSLIB)
CXXFLAGS += -ansi -pedantic -Wall -Wextra -std=c++14
CXXFLAGS += -MP -MMD
DBGFLAGS  = -ggdb3 -DDEBUG -O0
RLSFLAGS  = -O2
LDFLAGS   = -lwindow -lsystem -lX11 -lGL -lGLU -lXrandr

##############################################################################

# Builds main app

$(APPNAME) : $(APPNAME).cc
  make -C $(WINLIB)
  make -C $(SYSLIB)
	$(CXX) $(CXXFLAGS) $(RLSFLAGS) $< $(LDFLAGS) -o $@

# Builds main app (debug reasons)

debug : $(APPNAME).cc
  make debug -C $(WINLIB)
  make debug -C $(SYSLIB)
	$(CXX) $(CXXFLAGS) $(DBGFLAGS) $< $(LDFLAGS) -o $(APPNAME)_$@

#############################################################################

# Includes dependicies files early generated by gcc with -MP -MMD opts

-include $(SRCFILES:%.cc=%.d)

# Cleans garbage

clean :
  rm -rf gmon.out
  rm -rf $(APPNAME) $(APPNAME)_* *.d *.o 
  make clean -C $(SYSLIB)
  make clean -C $(WINLIB)
